# InquiryCircle Caddy Configuration
# Reverse proxy routing for full stack application

# Development configuration (localhost)
localhost {
    # Handle API requests - proxy to Django backend
    handle /api/* {
        reverse_proxy backend:8000 {
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Handle admin interface - proxy to Django backend  
    handle /admin/* {
        reverse_proxy backend:8000 {
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Handle static files from Django (if any)
    handle /static/* {
        reverse_proxy backend:8000
    }

    # Everything else goes to Vue frontend
    handle {
        reverse_proxy frontend:80 {
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
            header_down -X-Frame-Options
        }
    }

    # Enable access logs
    log {
        output file /var/log/caddy/access.log {
            roll_size 10mb
            roll_keep 10
        }
    }
}

# Production configuration (commented out for local testing)
# catbench.com {
#     # Handle API requests - proxy to Django backend
#     handle /api/* {
#         reverse_proxy backend:8000 {
#             header_up Host {host}
#             header_up X-Real-IP {remote}
#             header_up X-Forwarded-For {remote}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }

#     # Handle admin interface - proxy to Django backend
#     handle /admin/* {
#         reverse_proxy backend:8000 {
#             header_up Host {host}
#             header_up X-Real-IP {remote}
#             header_up X-Forwarded-For {remote}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }

#     # Handle static files from Django (if any)
#     handle /static/* {
#         reverse_proxy backend:8000
#     }

#     # Everything else goes to Vue frontend
#     handle {
#         reverse_proxy frontend:80 {
#             header_up Host {host}
#             header_up X-Real-IP {remote}
#             header_up X-Forwarded-For {remote}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }

#     # Security headers
#     header {
#         # Enable HSTS
#         Strict-Transport-Security max-age=31536000;
#         # Prevent frame embedding
#         X-Frame-Options DENY
#         # Prevent content type sniffing
#         X-Content-Type-Options nosniff
#         # Enable XSS protection
#         X-XSS-Protection "1; mode=block"
#         # Referrer policy
#         Referrer-Policy strict-origin-when-cross-origin
#     }

#     # Enable access logs
#     log {
#         output file /var/log/caddy/access.log {
#             roll_size 10mb
#             roll_keep 10
#         }
#     }
# }