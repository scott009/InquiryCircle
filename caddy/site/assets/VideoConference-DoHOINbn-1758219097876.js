import{d as P,u as I,f as l,y as O,z as k,c as _,o as C,a as o,g as y,h as x,t as m,v as D,C as T,i as w}from"./index-BNybao_Y-1758219097876.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U-1758219097876.js";class E{api=null;isScriptLoaded=!1;currentRoom=null;jitsiDomain="meet.jit.si";setJitsiDomain(e){this.jitsiDomain=e,this.isScriptLoaded=!1}async loadJitsiScript(){if(!this.isScriptLoaded)return new Promise((e,a)=>{const i=document.createElement("script");i.src=`https://${this.jitsiDomain}/external_api.js`,i.async=!0,i.onload=()=>{this.isScriptLoaded=!0,e()},i.onerror=()=>a(new Error("Failed to load Jitsi script")),document.head.appendChild(i)})}async initializeConference(e,a){try{await this.loadJitsiScript();const i=document.getElementById(a);if(!i)throw new Error(`Container with id ${a} not found`);const r={roomName:e.roomName,width:"100%",height:"500px",parentNode:i,jwt:e.jwt,configOverwrite:{prejoinPageEnabled:!1,startWithAudioMuted:!0,startWithVideoMuted:!1,enableWelcomePage:!1,enableClosePage:!1,requireDisplayName:!0,disableInviteFunctions:!0,enableLobbyChat:!1,enableInsecureRoomNameWarning:!1,...e.password&&{roomPassword:e.password},...e.moderator&&{startAudioMuted:999,startVideoMuted:999,enableUserRolesBasedOnToken:!0}},interfaceConfigOverwrite:{TOOLBAR_BUTTONS:["microphone","camera","desktop","fullscreen","hangup","chat","raisehand","tileview",...e.moderator?["mute-everyone","invite"]:[]],SHOW_JITSI_WATERMARK:!1,SHOW_WATERMARK_FOR_GUESTS:!1,SHOW_BRAND_WATERMARK:!1,BRAND_WATERMARK_LINK:"",DEFAULT_BACKGROUND:"#1e3a8a",DISABLE_VIDEO_BACKGROUND:!1,SHOW_PROMOTIONAL_CLOSE_PAGE:!1,SHOW_CHROME_EXTENSION_BANNER:!1},userInfo:{displayName:e.displayName,email:e.email}};return e.subject&&(r.configOverwrite={...r.configOverwrite,subject:e.subject}),this.api=new window.JitsiMeetExternalAPI(this.jitsiDomain,r),this.currentRoom=e.roomName,this.setupBasicEventHandlers(),this.api}catch(i){throw console.error("Failed to initialize Jitsi conference:",i),i}}onReadyToClose(e){this.api&&this.api.addEventListener("readyToClose",e)}onParticipantJoined(e){this.api&&this.api.addEventListener("participantJoined",e)}onParticipantLeft(e){this.api&&this.api.addEventListener("participantLeft",e)}onVideoConferenceJoined(e){this.api&&this.api.addEventListener("videoConferenceJoined",e)}onVideoConferenceLeft(e){this.api&&this.api.addEventListener("videoConferenceLeft",e)}executeCommand(e,...a){this.api&&this.api.executeCommand(e,...a)}hangup(){this.api&&this.api.executeCommand("hangup")}toggleAudio(){this.api&&this.api.executeCommand("toggleAudio")}toggleVideo(){this.api&&this.api.executeCommand("toggleVideo")}setupBasicEventHandlers(){this.api&&(this.api.addEventListener("readyToClose",()=>{console.log("Jitsi conference ready to close"),this.currentRoom=null}),this.api.addEventListener("participantRoleChanged",e=>{console.log("Participant role changed:",e)}),this.api.addEventListener("passwordRequired",()=>{console.log("Password required for room")}))}getCurrentRoom(){return this.currentRoom}isConferenceActive(){return this.api!==null&&this.currentRoom!==null}setPassword(e){this.api&&this.api.executeCommand("password",e)}lockRoom(){this.api&&this.api.executeCommand("lockRoom",!0)}unlockRoom(){this.api&&this.api.executeCommand("lockRoom",!1)}muteParticipant(e){this.api&&this.api.executeCommand("muteParticipant",e)}muteEveryone(){this.api&&this.api.executeCommand("muteEveryone")}kickParticipant(e){this.api&&this.api.executeCommand("kickParticipant",e)}admitParticipant(e){this.api&&this.api.executeCommand("grantModerator",e)}startRecording(){this.api&&this.api.executeCommand("startRecording",{mode:"file"})}stopRecording(){this.api&&this.api.executeCommand("stopRecording","file")}dispose(){this.api&&(this.api.dispose(),this.api=null,this.currentRoom=null)}static generateRoomName(e,a){const i=Date.now(),r=Math.random().toString(36).substring(2,8),n=`ic-${e}-${r}`;return a?`${n}-${a.substring(0,8)}`:`${n}-${i.toString().substring(-6)}`}static generateRoomPassword(){return Math.random().toString(36).substring(2,10).toUpperCase()}static isValidRoomName(e){return/^ic-[a-zA-Z0-9\-_]+$/.test(e)}}const c=new E,M={class:"video-conference"},V={class:"bg-white rounded-lg shadow-lg overflow-hidden"},B={class:"bg-blue-600 text-white px-6 py-4"},W={class:"text-xl font-semibold"},$={class:"text-blue-100 text-sm mt-1"},F={key:0,class:"p-6"},U={class:"mb-4"},H=["disabled"],z={id:"jitsi-conference",class:"w-full",style:{height:"500px"}},K={key:1,class:"bg-gray-50 px-6 py-3 border-t"},q={class:"flex justify-between items-center"},G={class:"text-sm text-gray-600"},X={key:2,class:"p-6 bg-red-50 border-l-4 border-red-400"},Y={class:"flex"},Z={class:"ml-3"},Q={class:"text-sm text-red-700"},ee=P({__name:"VideoConference",props:{circleId:{},sessionId:{},circleTitle:{default:"InquiryCircle Session"},userDisplayName:{default:""}},emits:["joined","left","participantJoined","participantLeft"],setup(b,{emit:e}){const a=b,i=e,r=I(),n=l(a.userDisplayName||""),d=l(!1),v=l(!1),u=l(0),f=l(""),g=l(null),h=l(null),R=l(`user-${Date.now()}-${Math.random().toString(36).substring(7)}`),N=O(()=>h.value?.room_name||E.generateRoomName(a.circleId,a.sessionId)),L=async()=>{const t=parseInt(a.circleId);if(isNaN(t))throw new Error(`Invalid circle ID: ${a.circleId}`);try{const s=await w.getRoomConfig(t);return h.value=s,s}catch(s){if(s.response?.status===404)if(r.isFacilitator){const p=await w.createRoom({circle_id:t,enable_lobby:!0,enable_recording:!1,max_participants:20});return h.value=p,p}else throw new Error("No active room found. Please ask the facilitator to start the video conference.");throw s}},S=async()=>{if(!n.value.trim()){f.value="Please enter your display name";return}try{v.value=!0,f.value="";const t=await L(),s=await c.initializeConference({roomName:t.room_name,displayName:n.value.trim(),subject:t.config.subject||a.circleTitle,password:t.room_password,moderator:r.isFacilitator},"jitsi-conference");g.value=s;try{await w.joinRoom(t.room_id,{participant_id:R.value,display_name:n.value.trim()})}catch(p){console.warn("Failed to notify backend of room join:",p)}A(),d.value=!0}catch(t){f.value=t.message||"Failed to join conference. Please try again.",console.error("Conference join error:",t)}finally{v.value=!1}},j=async()=>{if(g.value){if(h.value)try{await w.leaveRoom(h.value.room_id,{participant_id:R.value})}catch(t){console.warn("Failed to notify backend of room leave:",t)}c.hangup()}},A=()=>{g.value&&(c.onVideoConferenceJoined(t=>{console.log("Conference joined:",t),i("joined",t)}),c.onVideoConferenceLeft(()=>{console.log("Conference left"),d.value=!1,u.value=0,i("left")}),c.onParticipantJoined(t=>{console.log("Participant joined:",t),u.value++,i("participantJoined",t)}),c.onParticipantLeft(t=>{console.log("Participant left:",t),u.value=Math.max(0,u.value-1),i("participantLeft",t)}),c.onReadyToClose(()=>{console.log("Ready to close"),d.value=!1,u.value=0,i("left")}))};return k(()=>{g.value&&c.dispose()}),(t,s)=>(C(),_("div",M,[o("div",V,[o("div",B,[o("h2",W,m(t.circleTitle||"InquiryCircle Session"),1),o("p",$," Room: "+m(N.value)+" | Participants: "+m(u.value),1)]),d.value?y("",!0):(C(),_("div",F,[o("div",U,[s[1]||(s[1]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Your Display Name ",-1)),x(o("input",{"onUpdate:modelValue":s[0]||(s[0]=p=>n.value=p),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your name"},null,512),[[D,n.value]])]),o("button",{onClick:S,disabled:!n.value.trim()||v.value,class:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},m(v.value?"Connecting...":"Join Video Conference"),9,H)])),x(o("div",z,null,512),[[T,d.value]]),d.value?(C(),_("div",K,[o("div",q,[o("div",G," Connected as: "+m(n.value),1),o("button",{onClick:j,class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition-colors"}," Leave Conference ")])])):y("",!0),f.value?(C(),_("div",X,[o("div",Y,[s[2]||(s[2]=o("div",{class:"flex-shrink-0"},[o("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),o("div",Z,[o("p",Q,m(f.value),1)])])])):y("",!0)])]))}}),oe=J(ee,[["__scopeId","data-v-622e7279"]]);export{oe as V};
