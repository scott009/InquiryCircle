import{d as T,u as j,f as i,y as k,p as J,z as A,c as r,o as l,a as e,t as n,q as R,g as u,n as $,e as z,F as K,s as q,l as E,h as G,v as H,A as O,B as Q,i as p,m as W}from"./index-CDOJwjPW-1758219484319.js";import{V as X}from"./VideoConference-BROr8Qnk-1758219484319.js";import"./_plugin-vue_export-helper-DlAUqK2U-1758219484319.js";const Y={class:"min-h-screen bg-gray-50"},Z={class:"bg-white border-b border-gray-200"},ee={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},te={class:"py-6"},se={class:"flex items-center"},oe={class:"flex-1"},ae={class:"text-2xl font-bold text-gray-900"},ne={class:"text-sm text-gray-500 mt-1"},le={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},ie={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},re={class:"lg:col-span-2"},de={class:"bg-white shadow overflow-hidden sm:rounded-lg"},ce={class:"px-4 py-5 sm:p-6"},ue={class:"lg:col-span-1"},me={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-6"},ge={class:"px-4 py-5 sm:p-6"},ve={class:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-1"},pe={class:"mt-1 text-sm text-gray-900"},xe={class:"mt-1 text-sm text-gray-900"},fe={class:"mt-1 text-sm text-gray-900"},ye={key:0,class:"ml-2 text-green-600"},he={key:0},_e={class:"bg-white shadow overflow-hidden sm:rounded-lg"},we={class:"px-4 py-5 sm:p-6"},be={class:"space-y-4 max-h-64 overflow-y-auto mb-4"},ke={key:0,class:"text-center text-gray-500 py-4"},Ve={class:"text-sm font-medium text-gray-900"},Ce={class:"text-sm text-gray-600 mt-1"},Me={class:"text-xs text-gray-400 mt-1"},Se={key:0,class:"mt-4"},De={class:"flex space-x-2"},Ie=["disabled"],Le=T({__name:"CircleView",setup(Fe){const V=Q(),x=W(),h=j(),o=i(null),f=i([]),C=i([]),d=i(""),M=i(!0),c=i([]),m=i(!1);let g=null;const S=k(()=>`session-${Date.now()}`),y=k(()=>h.userRole==="facilitator"?"Facilitator":"Participant"),D=async()=>{try{const s=V.params.id,t=await p.getCircles();if(o.value=t.circles.find(a=>a.id.toString()===s)||null,!o.value){x.push("/circles");return}await v(),B()}catch(s){console.error("Failed to load circle:",s),x.push("/circles")}finally{M.value=!1}},v=async()=>{if(o.value)try{const s=await p.getMessages(o.value.id);f.value=s.messages}catch(s){console.error("Failed to load messages:",s)}},_=async()=>{if(!(!d.value.trim()||!o.value))try{await p.sendMessage({circle_id:o.value.id,content:d.value.trim()}),d.value="",await v()}catch(s){console.error("Failed to send message:",s)}},I=s=>{m.value=!0,console.log("Video conference joined:",s),w(`${y.value} joined the video conference`)},F=()=>{m.value=!1,c.value=[],console.log("Video conference left"),w(`${y.value} left the video conference`)},N=s=>{c.value.push(s),console.log("Video participant joined:",s)},P=s=>{c.value=c.value.filter(t=>t.id!==s.id),console.log("Video participant left:",s)},w=async s=>{if(o.value)try{await p.sendMessage({circle_id:o.value.id,content:s,message_type:"system"}),await v()}catch(t){console.error("Failed to send system message:",t)}},B=()=>{g=window.setInterval(v,5e3)},L=()=>{g&&(clearInterval(g),g=null)},U=()=>{x.push("/circles")},b=s=>s?new Date(s).toLocaleDateString():"Unknown";return J(()=>{D()}),A(()=>{L()}),(s,t)=>(l(),r("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[e("button",{onClick:U,class:"mr-4 p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[...t[1]||(t[1]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("div",oe,[e("h1",ae,n(o.value?.name||"Loading..."),1),e("p",ne,n(o.value?.description||"No description"),1)])])])])]),e("div",le,[e("div",ie,[e("div",re,[e("div",de,[e("div",ce,[t[2]||(t[2]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"}," Video Conference ",-1)),o.value?(l(),R(X,{key:0,circleId:o.value.id.toString(),sessionId:S.value,circleTitle:o.value.name,userDisplayName:y.value,onJoined:I,onLeft:F,onParticipantJoined:N,onParticipantLeft:P},null,8,["circleId","sessionId","circleTitle","userDisplayName"])):u("",!0)])])]),e("div",ue,[e("div",me,[e("div",ge,[t[7]||(t[7]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"}," Circle Information ",-1)),e("dl",ve,[e("div",null,[t[3]||(t[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Status",-1)),e("dd",pe,[e("span",{class:$({"text-green-600":o.value?.status==="active","text-yellow-600":o.value?.status==="inactive","text-gray-600":o.value?.status==="ended"})},n(o.value?.status?o.value.status.charAt(0).toUpperCase()+o.value.status.slice(1):"Unknown"),3)])]),e("div",null,[t[4]||(t[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Created",-1)),e("dd",xe,n(b(o.value?.created_at)),1)]),e("div",null,[t[5]||(t[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Participants",-1)),e("dd",fe,[z(n(Math.max(C.value.length,c.value.length))+" total ",1),m.value?(l(),r("span",ye," ("+n(c.value.length+1)+" in video) ",1)):u("",!0)])]),m.value?(l(),r("div",he,[...t[6]||(t[6]=[e("dt",{class:"text-sm font-medium text-gray-500"},"Video Status",-1),e("dd",{class:"mt-1 text-sm text-green-600 font-medium"}," ● Connected to video conference ",-1)])])):u("",!0)])])]),e("div",_e,[e("div",we,[t[8]||(t[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"}," Messages ",-1)),e("div",be,[f.value.length===0?(l(),r("div",ke," No messages yet ")):u("",!0),(l(!0),r(K,null,q(f.value,a=>(l(),r("div",{key:a.id,class:"border-b border-gray-200 pb-2"},[e("div",Ve,n(a.sender_role||"User"),1),e("div",Ce,n(a.content),1),e("div",Me,n(b(a.timestamp||a.sent_at)),1)]))),128))]),E(h).isFacilitator?(l(),r("div",Se,[e("div",De,[G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),type:"text",placeholder:"Type a message...",class:"flex-1 min-w-0 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",onKeypress:O(_,["enter"])},null,544),[[H,d.value]]),e("button",{onClick:_,disabled:!d.value.trim(),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Send ",8,Ie)])])):u("",!0)])])])])])]))}});export{Le as default};
